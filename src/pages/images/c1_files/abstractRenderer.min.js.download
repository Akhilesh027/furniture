define(["uiComponent","dataServicesBase","jquery","Magento_Catalog/js/price-utils",'Magento_Customer/js/customer-data',"slick",'mage/translate','Magento_Catalog/js/product/view/product-ids-resolver','Magento_Catalog/js/product/view/product-info-resolver'],function(Component,ds,$,priceUnits,customerData,slick,$t,idsResolver,productInfoResolver){"use strict"
return Component.extend({defaults:{template:"Magento_ProductRecommendationsLayout/recommendations.html",recs:[],},initialize:function(config){this._super(config);this.pagePlacement=config.pagePlacement;this.placeholderUrl=config.placeholderUrl;this.priceFormat=config.priceFormat;this.priceUnits=priceUnits;this.currencyConfiguration=config.currencyConfiguration;this.alternateEnvironmentId=config.alternateEnvironmentId;this.customer=customerData.get('customer');return this;},initObservable:function(){return this._super().observe(["recs"])},processResponse(response){const units=[]
if(!response.length||response[0].unitId===undefined){return units}
for(let i=0;i<response.length;i++){response[i].products=response[i].products.slice(0,response[i].displayNumber,)
for(let j=0;j<response[i].products.length;j++){if(response[i].products[j].productId){const form_key=$.cookie("form_key")
const url=this.createAddToCartUrl(response[i].products[j].productId,)
const postUenc=this.encodeUenc(url)
const addToCart={form_key,url,postUenc}
response[i].products[j].addToCart=addToCart}
if(this.currencyConfiguration&&response[i].products[j].currency!==this.currencyConfiguration.currency){if(response[i].products[j].prices===null){response[i].products[j].prices={minimum:{final:null},}}else{response[i].products[j].prices.minimum.final=response[i].products[j].prices&&response[i].products[j].prices.minimum&&response[i].products[j].prices.minimum.final?this.convertPrice(response[i].products[j].prices.minimum.final,):null}
response[i].products[j].currency=this.currencyConfiguration.currency}}
units.push(response[i])}
units.sort((a,b)=>a.displayOrder-b.displayOrder)
return units},loadJsAfterKoRender:function(self,unit){const renderEvent=new CustomEvent("render",{detail:unit});document.dispatchEvent(renderEvent);var myCarousel=$(".recommendation-products .product-items:not(.slick-initialized)");myCarousel.each(function(){$(this).slick({arrows:true,fade:false,dots:false,infinite:true,speed:300,slidesToShow:4,slidesToScroll:4,responsive:[{breakpoint:768,settings:{arrows:true,dots:true,centerMode:true,centerPadding:'10px',slidesToShow:1}},{breakpoint:480,settings:{arrows:true,dots:true,centerMode:true,centerPadding:'10px',slidesToShow:1}}]});});$('.recommendation-products [data-role=tocart-form]').submit(function(event){event.preventDefault();var form=$(this),productIds=idsResolver(form),productInfo=productInfoResolver(form);var addToCartButtonTextWhileAdding=$t('Adding...');var addToCartButton=$(form).find('.action.tocart');addToCartButton.addClass('disabled');addToCartButton.find('span').text(addToCartButtonTextWhileAdding);addToCartButton.attr('title',addToCartButtonTextWhileAdding);$.ajax({type:"POST",url:$(this).attr('action'),data:$(this).serialize(),success:function(res){var eventData,parameters;$(document).trigger('ajax:addToCart',{'sku':form.data().productSku,'productIds':productIds,'productInfo':productInfo,'form':form,'response':res});if(res.backUrl){eventData={'form':form,'redirectParameters':[]};$('body').trigger('catalogCategoryAddToCartRedirect',eventData);if(eventData.redirectParameters.length>0&&window.location.href.split(/[?#]/)[0]===res.backUrl){parameters=res.backUrl.split('#');parameters.push(eventData.redirectParameters.join('&'));res.backUrl=parameters.join('#');}
self._redirect(res.backUrl);return;}
if(res.messages){$('[data-placeholder="messages"]').html(res.messages);}
if(res.minicart){$('[data-block="minicart"]').replaceWith(res.minicart);$('[data-block="minicart"]').trigger('contentUpdated');}
if(res.product&&res.product.statusText){$('.stock.available').removeClass('available').addClass('unavailable').find('span').html(res.product.statusText);}
var addToCartButtonTextAdded=$t('Added'),self=this,addToCartButton=$(form).find('.action.tocart');addToCartButton.find('span').text(addToCartButtonTextAdded);addToCartButton.prop('title',addToCartButtonTextAdded);setTimeout(function(){var addToCartButtonTextDefault=$t('Add to Cart');addToCartButton.removeClass('disabled');addToCartButton.find('span').text(addToCartButtonTextDefault);addToCartButton.prop('title',addToCartButtonTextDefault);},1000);},error:function(res){$(document).trigger('ajax:addToCart:error',{'sku':form.data().productSku,'productIds':productIds,'productInfo':productInfo,'form':form,'response':res});},complete:function(res){if(res.state()==='rejected'){location.reload();}}});});},convertPrice:function(price){return parseFloat(price*this.currencyConfiguration.rate)},createAddToCartUrl(productId){const currentLocationUENC=encodeURIComponent(this.encodeUenc(BASE_URL),)
const postUrl=BASE_URL+"checkout/cart/add/uenc/"+
currentLocationUENC+"/product/"+
productId
return postUrl},encodeUenc:function(value){const regex=/=/gi
return btoa(value).replace(regex,",")},})})